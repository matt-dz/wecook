openapi: 3.0.3
info:
  title: WeCook API
  version: "1.0"
  description: API Server for the WeCook application.
  contact: {}

servers:
  - url: /

security:
  - AccessTokenUserBearer: []

paths:
  /api/openapi.yaml:
    get:
      summary: Get OpenAPI specification.
      tags:
        - Documentation
      responses:
        "200":
          description: OpenAPI specification file
          content:
            application/x-yaml:
              schema:
                type: string
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
      security: []

  /api/ping:
    get:
      summary: Ping endpoint.
      tags:
        - Ping
      responses:
        "200":
          description: OK
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
      security: []

  /api/admin:
    post:
      summary: Create an admin.
      tags:
        - Admin
      requestBody:
        description: Create Admin Request
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAdminRequest"
      responses:
        "204":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateAdminResponse"
        "409":
          description: Status Conflict
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "422":
          description: Unprocessible Entity
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
      security:
        - AccessTokenAdminBearer: []

  /api/admin/user:
    post:
      summary: Create a user.
      tags:
        - User
      requestBody:
        description: Create User Request
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "204":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateUserResponse"
        "409":
          description: Status Conflict
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "422":
          description: Unprocessible Entity
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
      security:
        - AccessTokenAdminBearer: []

  /api/auth/refresh:
    post:
      summary: Refresh session tokens
      tags:
        - Auth
      description: >
        Uses a valid refresh token cookie to issue a new access and refresh token pair.
      security: []
      parameters:
        - name: refresh
          in: cookie
          schema:
            type: string
          description: Refresh token
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshToken"
      responses:
        "200":
          description: >
            OK - For browser clients, access and refresh tokens are set as HTTP-only
            cookies. For API clients/Swagger, an access token is also returned in the body.
          headers:
            Set-Cookie:
              description: >
                HTTP-only cookies for access and refresh tokens. This header is sent twice:
                once for the "access" cookie and once for the "refresh" cookie.
              schema:
                type: string
              examples:
                access:
                  summary: Access token cookie
                  value: access=<jwt_token>; HttpOnly; Secure; SameSite=Lax; Path=/
                refresh:
                  summary: Refresh token cookie
                  value: refresh=<jwt_token>; HttpOnly; Secure; SameSite=Lax; Path=/
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          description: Expired, invalid, or missing refresh token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/auth/verify:
    get:
      summary: Verify user session
      tags:
        - Auth
      description: |
        Validates the user's access token cookie, checks expiration,
        and ensures the user has the required role.
      parameters:
        - name: access
          in: cookie
          schema:
            type: string
          description: Access token
        - name: role
          in: query
          schema:
            $ref: "#/components/schemas/Role"
      responses:
        "204":
          description: Session is valid
        "401":
          description: Expired, invalid, or missing access token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/login:
    post:
      summary: User login.
      tags:
        - User
        - Auth
      security: []
      requestBody:
        description: User Login Request
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLoginRequest"
      responses:
        "200":
          description: >
            OK - For browser clients, access and refresh tokens are set as HTTP-only
            cookies. For API clients/Swagger, an access token is also returned in the body.
          headers:
            Set-Cookie:
              description: >
                HTTP-only cookies for access and refresh tokens. This header is sent twice:
                once for the "access" cookie and once for the "refresh" cookie.
              schema:
                type: string
              examples:
                access:
                  summary: Access token cookie
                  value: access=<jwt_token>; HttpOnly; Secure; SameSite=Lax; Path=/
                refresh:
                  summary: Refresh token cookie
                  value: refresh=<jwt_token>; HttpOnly; Secure; SameSite=Lax; Path=/
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/user:
    get:
      summary: Get current user
      tags:
        - User
      description: Get information of the user associated with the access token.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: User Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid access token cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/users:
    get:
      summary: Get users
      tags:
        - User
      description: Get all users.
      security:
        - AccessTokenAdminBearer: []
      parameters:
        - name: after
          in: query
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: limit
          in: query
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 100
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetUsersResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid access token cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/user/invite:
    post:
      summary: Invite a user
      tags:
        - User
      description: >
        Invites a new user to the platform by sending them an
        email. The email will contain a unique signup link that
        they will signup with. The link will contain a code that
        should be used to verify their invitation.
      security:
        - AccessTokenAdminBearer: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InviteUserRequest"
      responses:
        "204":
          description: OK
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid access token cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/user/password:
    patch:
      summary: Update password
      tags:
        - User
        - Auth
      description: >
        Update the current user's password.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePasswordRequest"
      responses:
        "204":
          description: OK
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid invite code
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "422":
          description: >
            Unprocessible Entity - current password is incorrect or
            new password is invalid.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/signup:
    post:
      summary: Sign up
      tags:
        - User
        - Auth
      description: >
        Sign up with a new email and password. If platform is 
        invite-only, requires an invite code.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequest"
      security: []
      responses:
        "200":
          description: >
            OK - For browser clients, access and refresh tokens are set as HTTP-only
            cookies. For API clients/Swagger, an access token is also returned in the body.
          headers:
            Set-Cookie:
              description: >
                HTTP-only cookies for access and refresh tokens. This header is sent twice:
                once for the "access" cookie and once for the "refresh" cookie.
              schema:
                type: string
              examples:
                access:
                  summary: Access token cookie
                  value: access=<jwt_token>; HttpOnly; Secure; SameSite=Lax; Path=/
                refresh:
                  summary: Refresh token cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid invite code
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: Conflict - email already in use
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "422":
          description: Unprocessible Entity - invalid invite code
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes:
    post:
      summary: Create a new recipe
      tags:
        - Recipes
      description: >
        Creates a new (empty) recipe for the authenticated user.
      responses:
        "201":
          description: Recipe successfully created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateRecipeResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid access token cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    get:
      summary: Get all personal recipes
      tags:
        - Recipes
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRecipesResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized — missing or invalid access token cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/public:
    get:
      summary: Get all public recipes
      tags:
        - Recipes
      security: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRecipesResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/public:
    get:
      summary: Get a public recipe and its owner's information
      tags:
        - Recipes
      description: >
        Retrieves a recipe by ID, including recipe details and the owner's basic information.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: ID of the recipe to retrieve
          schema:
            type: integer
            format: int64
            minimum: 0
      security: []
      responses:
        "200":
          description: Recipe found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRecipeResponse"
        "400":
          description: Bad request (invalid recipe ID)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}:
    get:
      summary: Get a personal recipe and the owner information
      tags:
        - Recipes
      description: >
        Retrieves a recipe by ID, including recipe details and the owner's basic information.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: ID of the recipe to retrieve
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "200":
          description: Recipe found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetRecipeResponse"
        "400":
          description: Bad request (invalid recipe ID)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    patch:
      summary: Update a recipe
      tags:
        - Recipes
      description: >
        Updates a recipe owned by the authenticated user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRecipe"
      responses:
        "200":
          description: Recipe Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Recipe"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete a recipe
      tags:
        - Recipes
      description: >
        Deletes a recipe owned by the authenticated user.
        This operation is idempotent — deleting an already deleted 
        or non-owned recipe results in a 404.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "204":
          description: Recipe deleted successfully
        "400":
          description: Bad request (invalid recipe ID)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/image:
    post:
      summary: Create an cover image for a recipe.
      tags:
        - Recipes
      description: >
        Creates a cover image for a recipe. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/UpdateRecipeImageForm"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Recipe"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    delete:
      summary: Delete a cover image from a recipe.
      tags:
        - Recipes
      description: >
        Deletes a cover image from a recipe. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "204":
          description: No Content
        "404":
          description: Recipe Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/ingredients:
    post:
      summary: Create an ingredient for a recipe.
      tags:
        - Recipes
        - Ingredients
      description: >
        Creates an ingredient for the recipe. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "200":
          description: Ingredient Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateIngredientResponse"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/recipes/{recipeID}/ingredients/{ingredientID}:
    patch:
      summary: Update an ingredient for a recipe.
      tags:
        - Recipes
        - Ingredients
      description: >
        Updates an ingredient for the recipe. The recipe must be
        owned by the user. If no fields are provided, the operation
        is considered a no-op.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: ingredientID
          in: path
          required: true
          description: Ingredient ID
          schema:
            type: integer
            format: int64
            minimum: 0
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateIngredientBody"
      responses:
        "200":
          description: Ingredient Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateIngredientResponse"
        "400":
          description: Invalid Form
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    delete:
      summary: Delete an ingredient from a recipe.
      tags:
        - Recipes
        - Ingredients
      description: >
        Deletes an ingredient from the recipe. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: ingredientID
          in: path
          required: true
          description: Ingredient ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "204":
          description: Ingredient Deleted
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/ingredients/{ingredientID}/image:
    post:
      summary: Upload an image for a recipe ingredient
      tags:
        - Recipes
        - Ingredients
      description: >
        Uploads an image for a recipe ingredient. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: ingredientID
          in: path
          required: true
          description: Ingredient ID
          schema:
            type: integer
            format: int64
            minimum: 0
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/UpdateIngredientImageForm"
      responses:
        "200":
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateIngredientResponse"
        "400":
          description: Invalid request or file format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe or ingredient not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete an image from a recipe ingredient
      tags:
        - Recipes
        - Ingredients
      description: >
        Deletes an image from a recipe ingredient. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: ingredientID
          in: path
          required: true
          description: Ingredient ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "204":
          description: Image deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe or ingredient not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/steps:
    post:
      summary: Create a step for a recipe.
      tags:
        - Recipes
        - Steps
      description: >
        Creates a step for the recipe. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "200":
          description: Step Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateStepResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/steps/{stepID}:
    patch:
      summary: Update a step for a recipe.
      tags:
        - Recipes
        - Steps
      description: >
        Updates a steps for the recipe. The recipe must be
        owned by the user. If no fields are provided, the operation
        is considered a no-op.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: stepID
          in: path
          required: true
          description: Step ID
          schema:
            type: integer
            format: int64
            minimum: 0
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateStepRequest"
      responses:
        "200":
          description: Step Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateStepResponse"
        "400":
          description: Invalid Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete a step from a recipe.
      tags:
        - Recipes
        - Steps
      description: >
        Deletes a steps from a recipe. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: stepID
          in: path
          required: true
          description: Step ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "204":
          description: Step Deleted
        "400":
          description: Invalid Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/recipes/{recipeID}/steps/{stepID}/image:
    post:
      summary: Upload an image for a recipe step
      tags:
        - Recipes
        - Steps
      description: >
        Uploads an image for a recipe step. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: stepID
          in: path
          required: true
          description: Step ID
          schema:
            type: integer
            format: int64
            minimum: 0
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/UpdateStepImageForm"
      responses:
        "200":
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateStepResponse"
        "400":
          description: Invalid request or file format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe or ingredient not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    delete:
      summary: Delete an image from a recipe step
      tags:
        - Recipes
        - Steps
      description: >
        Deletes an image from a recipe step. The recipe must be
        owned by the user.
      parameters:
        - name: recipeID
          in: path
          required: true
          description: Recipe ID
          schema:
            type: integer
            format: int64
            minimum: 0
        - name: stepID
          in: path
          required: true
          description: Ingredient ID
          schema:
            type: integer
            format: int64
            minimum: 0
      responses:
        "204":
          description: Image deleted successfully
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Recipe or step not found or not owned by user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Error:
      type: object
      description: Standard error response
      properties:
        code:
          type: string
        error_id:
          type: string
        message:
          type: string
        status:
          type: integer
      required: [code, error_id, message, status]

    Recipe:
      type: object
      properties:
        cook_time_amount:
          type: integer
          format: int32
          minimum: 0
        cook_time_unit:
          $ref: "#/components/schemas/TimeUnit"
        created_at:
          type: string
          format: date-time
        description:
          type: string
        id:
          type: integer
          format: int64
          minimum: 0
        image_url:
          type: string
        prep_time_amount:
          type: integer
          format: int32
          minimum: 0
        prep_time_unit:
          $ref: "#/components/schemas/TimeUnit"
        published:
          type: boolean
        servings:
          type: number
          minimum: 0
          exclusiveMinimum: true
        title:
          type: string
        updated_at:
          type: string
          format: date-time
        user_id:
          type: integer
          format: int64
          minimum: 0
      required:
        - id
        - user_id
        - published
        - title
        - created_at
        - updated_at

    RecipeOwner:
      type: object
      properties:
        first_name:
          type: string
        last_name:
          type: string
        id:
          type: integer
          format: int64
          minimum: 0
      required:
        - first_name
        - last_name
        - id

    RecipeIngredient:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        image_url:
          type: string
        name:
          type: string
        quantity:
          type: number
        recipe_id:
          type: integer
          format: int64
          minimum: 0
        unit:
          type: string
      required:
        - id
        - recipe_id

    RecipeStep:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        image_url:
          type: string
        instruction:
          type: string
        recipe_id:
          type: integer
          format: int64
          minimum: 0
        step_number:
          type: integer
          format: int32
          minimum: 0
      required:
        - id
        - recipe_id
        - step_number

    RecipeAndOwner:
      type: object
      properties:
        owner:
          $ref: "#/components/schemas/RecipeOwner"
        recipe:
          $ref: "#/components/schemas/Recipe"

    RecipeWithIngredientsAndSteps:
      allOf:
        - $ref: "#/components/schemas/Recipe"
        - type: object
          properties:
            ingredients:
              type: array
              items:
                $ref: "#/components/schemas/RecipeIngredient"
            steps:
              type: array
              items:
                $ref: "#/components/schemas/RecipeStep"
          required:
            - ingredients
            - steps

    CreateAdminRequest:
      type: object
      required:
        - email
        - first_name
        - last_name
        - password
      properties:
        email:
          type: string
          format: email
        first_name:
          type: string
        last_name:
          type: string
        password:
          type: string

    CreateAdminResponse:
      type: object
      properties:
        user_id:
          type: integer

    CreateRecipeResponse:
      type: object
      properties:
        recipe_id:
          type: integer
          format: int64
          minimum: 0
          description: Recipe ID
      required:
        - recipe_id

    GetRecipesResponse:
      type: object
      properties:
        recipes:
          type: array
          items:
            $ref: "#/components/schemas/RecipeAndOwner"
      required:
        - recipes

    GetRecipeResponse:
      type: object
      properties:
        owner:
          $ref: "#/components/schemas/RecipeOwner"
        recipe:
          $ref: "#/components/schemas/RecipeWithIngredientsAndSteps"
      required:
        - owner
        - recipe

    CreateUserRequest:
      type: object
      required:
        - email
        - first_name
        - last_name
        - password
      properties:
        email:
          type: string
          format: email
        first_name:
          type: string
        last_name:
          type: string
        password:
          type: string

    CreateUserResponse:
      type: object
      properties:
        user_id:
          type: integer

    UserLoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
        password:
          type: string

    UpdateRecipeIngredient:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        name:
          type: string
        quantity:
          type: number
          minimum: 0
          exclusiveMinimum: true
        unit:
          type: string

    UpdateRecipeStep:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        instruction:
          type: string
        step_number:
          type: integer
          format: int32
          minimum: 1
      required: []

    UpdateRecipe:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
          nullable: true
        published:
          type: boolean
        servings:
          type: number
          minimum: 0
          exclusiveMinimum: true
          nullable: true
        cook_time_amount:
          type: integer
          format: int32
          minimum: 0
          nullable: true
        cook_time_unit:
          allOf:
            - $ref: "#/components/schemas/TimeUnit"
          nullable: true
        prep_time_amount:
          type: integer
          format: int32
          minimum: 0
          nullable: true
        prep_time_unit:
          allOf:
            - $ref: "#/components/schemas/TimeUnit"
          nullable: true

    TimeUnit:
      type: string
      enum:
        - minutes
        - hours
        - days

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
          description: >
            JWT access token to use in the Authorization: Bearer header.
        token_type:
          type: string
          example: Bearer
        expires_in:
          type: integer
          format: int64
          description: Access token lifetime in seconds.
      required:
        - access_token

    RefreshToken:
      type: object
      properties:
        refresh_token:
          type: string
          description: Refresh token

    CreateIngredientResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        quantity:
          type: number
          minimum: 0
          exclusiveMinimum: true
        name:
          type: string
        image_url:
          type: string
        unit:
          type: string
      required:
        - id

    CreateStepResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        step_number:
          type: integer
          format: int32
          minimum: 1
        instruction:
          type: string
      required:
        - id
        - step_number

    UpdateIngredientBody:
      type: object
      properties:
        quantity:
          type: number
          minimum: 0
          exclusiveMinimum: true
          nullable: true
        name:
          type: string
          nullable: true
        unit:
          type: string
          nullable: true

    UpdateIngredientImageForm:
      type: object
      properties:
        image:
          type: string
          format: binary
      required:
        - image

    UpdateRecipeImageForm:
      type: object
      properties:
        image:
          type: string
          format: binary
      required:
        - image

    UpdateStepImageForm:
      type: object
      properties:
        image:
          type: string
          format: binary
      required:
        - image

    UpdateIngredientResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        quantity:
          type: number
          minimum: 0
          exclusiveMinimum: true
        name:
          type: string
        image_url:
          type: string
        unit:
          type: string
      required:
        - id
        - name

    UpdateStepRequest:
      type: object
      properties:
        step_number:
          type: integer
          format: int32
          minimum: 1
        instruction:
          type: string
          nullable: true

    UpdateStepResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        instruction:
          type: string
        step_number:
          type: integer
          format: int32
          minimum: 1
        image_url:
          type: string
      required:
        - id
        - step_number

    Role:
      type: string
      enum:
        - user
        - admin

    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          minimum: 0
        email:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        role:
          $ref: "#/components/schemas/Role"
      required:
        - id
        - email
        - first_name
        - last_name
        - role

    GetUsersResponse:
      type: object
      properties:
        users:
          type: array
          items:
            $ref: "#/components/schemas/User"
        cursor:
          type: integer
          format: int64
          minimum: 0
      required:
        - users
        - cursor

    InviteUserRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: "Email Address"
      required:
        - email

    SignupRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: "Email Address"
        password:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        invite_code:
          type: string
      required:
        - email
        - first_name
        - last_name
        - password

    UpdatePasswordRequest:
      type: object
      properties:
        current_password:
          type: string
          description: "Current Password"
        new_password:
          type: string
          description: "New Password"
      required:
        - current_password
        - new_password

  securitySchemes:
    AccessTokenUserBearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
    AccessTokenAdminBearer:
      type: http
      scheme: bearer
      bearerFormat: JWT

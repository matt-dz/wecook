// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.28.0
// source: query.sql

package database

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const checkRecipeOwnership = `-- name: CheckRecipeOwnership :one
SELECT
  EXISTS (
    SELECT
      1
    FROM
      recipes
    WHERE
      id = $1
      AND user_id = $2)
`

type CheckRecipeOwnershipParams struct {
	ID     int64
	UserID pgtype.Int8
}

func (q *Queries) CheckRecipeOwnership(ctx context.Context, arg CheckRecipeOwnershipParams) (bool, error) {
	row := q.db.QueryRow(ctx, checkRecipeOwnership, arg.ID, arg.UserID)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const checkUsersTableExists = `-- name: CheckUsersTableExists :one
SELECT
  EXISTS (
    SELECT
      1
    FROM
      information_schema.tables
    WHERE
      table_schema = 'public'
      AND table_name = 'users')
`

func (q *Queries) CheckUsersTableExists(ctx context.Context) (bool, error) {
	row := q.db.QueryRow(ctx, checkUsersTableExists)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const createAdmin = `-- name: CreateAdmin :one
INSERT INTO users (email, first_name, last_name, password_hash, role)
  VALUES (trim(lower($4::text)), $1, $2, $3, 'admin')
RETURNING
  id
`

type CreateAdminParams struct {
	FirstName    string
	LastName     string
	PasswordHash string
	Email        string
}

func (q *Queries) CreateAdmin(ctx context.Context, arg CreateAdminParams) (int64, error) {
	row := q.db.QueryRow(ctx, createAdmin,
		arg.FirstName,
		arg.LastName,
		arg.PasswordHash,
		arg.Email,
	)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const createRecipe = `-- name: CreateRecipe :one
INSERT INTO recipes (user_id, title)
  VALUES ($1, $2)
RETURNING
  id
`

type CreateRecipeParams struct {
	UserID pgtype.Int8
	Title  string
}

func (q *Queries) CreateRecipe(ctx context.Context, arg CreateRecipeParams) (int64, error) {
	row := q.db.QueryRow(ctx, createRecipe, arg.UserID, arg.Title)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const createRecipeIngredient = `-- name: CreateRecipeIngredient :one
INSERT INTO recipe_ingredients (recipe_id, quantity, unit, name, image_url)
  VALUES ($1, $2, $3, $4, $5)
RETURNING
  id
`

type CreateRecipeIngredientParams struct {
	RecipeID int64
	Quantity float32
	Unit     pgtype.Text
	Name     string
	ImageUrl pgtype.Text
}

func (q *Queries) CreateRecipeIngredient(ctx context.Context, arg CreateRecipeIngredientParams) (int64, error) {
	row := q.db.QueryRow(ctx, createRecipeIngredient,
		arg.RecipeID,
		arg.Quantity,
		arg.Unit,
		arg.Name,
		arg.ImageUrl,
	)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const createRecipeStep = `-- name: CreateRecipeStep :one
INSERT INTO recipe_steps (recipe_id, instruction)
  VALUES ($1, $2)
RETURNING
  id
`

type CreateRecipeStepParams struct {
	RecipeID    int64
	Instruction string
}

func (q *Queries) CreateRecipeStep(ctx context.Context, arg CreateRecipeStepParams) (int64, error) {
	row := q.db.QueryRow(ctx, createRecipeStep, arg.RecipeID, arg.Instruction)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const createUser = `-- name: CreateUser :one
INSERT INTO users (email, first_name, last_name, password_hash, role)
  VALUES (trim(lower($4::text)), $1, $2, $3, 'user')
RETURNING
  id
`

type CreateUserParams struct {
	FirstName    string
	LastName     string
	PasswordHash string
	Email        string
}

func (q *Queries) CreateUser(ctx context.Context, arg CreateUserParams) (int64, error) {
	row := q.db.QueryRow(ctx, createUser,
		arg.FirstName,
		arg.LastName,
		arg.PasswordHash,
		arg.Email,
	)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const deleteRecipe = `-- name: DeleteRecipe :exec
DELETE FROM recipes
WHERE id = $1
`

func (q *Queries) DeleteRecipe(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteRecipe, id)
	return err
}

const deleteRecipeIngredient = `-- name: DeleteRecipeIngredient :exec
DELETE FROM recipe_ingredients
WHERE id = $1
`

func (q *Queries) DeleteRecipeIngredient(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteRecipeIngredient, id)
	return err
}

const deleteRecipeStep = `-- name: DeleteRecipeStep :exec
DELETE FROM recipe_steps
WHERE id = $1
`

func (q *Queries) DeleteRecipeStep(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteRecipeStep, id)
	return err
}

const getAdminCount = `-- name: GetAdminCount :one
SELECT
  count(*)
FROM
  users
WHERE
  ROLE = 'admin'
`

func (q *Queries) GetAdminCount(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, getAdminCount)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getRecipeAndOwner = `-- name: GetRecipeAndOwner :one
SELECT
  r.user_id,
  r.image_url,
  r.title,
  r.description,
  r.created_at,
  r.updated_at,
  r.published,
  r.cook_time_minutes,
  u.first_name,
  u.last_name,
  u.id
FROM
  recipes r
  JOIN users u ON r.user_id = u.id
WHERE
  r.id = $1
  AND r.published = TRUE
`

type GetRecipeAndOwnerRow struct {
	UserID          pgtype.Int8
	ImageUrl        pgtype.Text
	Title           string
	Description     pgtype.Text
	CreatedAt       pgtype.Timestamptz
	UpdatedAt       pgtype.Timestamptz
	Published       bool
	CookTimeMinutes pgtype.Int4
	FirstName       string
	LastName        string
	ID              int64
}

func (q *Queries) GetRecipeAndOwner(ctx context.Context, id int64) (GetRecipeAndOwnerRow, error) {
	row := q.db.QueryRow(ctx, getRecipeAndOwner, id)
	var i GetRecipeAndOwnerRow
	err := row.Scan(
		&i.UserID,
		&i.ImageUrl,
		&i.Title,
		&i.Description,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.Published,
		&i.CookTimeMinutes,
		&i.FirstName,
		&i.LastName,
		&i.ID,
	)
	return i, err
}

const getRecipeIngredientExistence = `-- name: GetRecipeIngredientExistence :one
SELECT
  EXISTS (
    SELECT
      1
    FROM
      recipe_ingredients
    WHERE
      id = $1)
`

func (q *Queries) GetRecipeIngredientExistence(ctx context.Context, id int64) (bool, error) {
	row := q.db.QueryRow(ctx, getRecipeIngredientExistence, id)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const getRecipeIngredientImageURL = `-- name: GetRecipeIngredientImageURL :one
SELECT
  image_url
FROM
  recipe_ingredients
WHERE
  id = $1
`

func (q *Queries) GetRecipeIngredientImageURL(ctx context.Context, id int64) (pgtype.Text, error) {
	row := q.db.QueryRow(ctx, getRecipeIngredientImageURL, id)
	var image_url pgtype.Text
	err := row.Scan(&image_url)
	return image_url, err
}

const getRecipeIngredients = `-- name: GetRecipeIngredients :many
SELECT
  id, recipe_id, quantity, unit, name, image_url, created_at, updated_at
FROM
  recipe_ingredients
WHERE
  recipe_id = $1
ORDER BY
  created_at ASC
`

func (q *Queries) GetRecipeIngredients(ctx context.Context, recipeID int64) ([]RecipeIngredient, error) {
	rows, err := q.db.Query(ctx, getRecipeIngredients, recipeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []RecipeIngredient
	for rows.Next() {
		var i RecipeIngredient
		if err := rows.Scan(
			&i.ID,
			&i.RecipeID,
			&i.Quantity,
			&i.Unit,
			&i.Name,
			&i.ImageUrl,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getRecipeOwner = `-- name: GetRecipeOwner :one
SELECT
  user_id
FROM
  recipes
WHERE
  id = $1
`

func (q *Queries) GetRecipeOwner(ctx context.Context, id int64) (pgtype.Int8, error) {
	row := q.db.QueryRow(ctx, getRecipeOwner, id)
	var user_id pgtype.Int8
	err := row.Scan(&user_id)
	return user_id, err
}

const getRecipeStepExistence = `-- name: GetRecipeStepExistence :one
SELECT
  EXISTS (
    SELECT
      1
    FROM
      recipe_steps
    WHERE
      id = $1)
`

func (q *Queries) GetRecipeStepExistence(ctx context.Context, id int64) (bool, error) {
	row := q.db.QueryRow(ctx, getRecipeStepExistence, id)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const getRecipeStepImageURL = `-- name: GetRecipeStepImageURL :one
SELECT
  image_url
FROM
  recipe_steps
WHERE
  id = $1
`

func (q *Queries) GetRecipeStepImageURL(ctx context.Context, id int64) (pgtype.Text, error) {
	row := q.db.QueryRow(ctx, getRecipeStepImageURL, id)
	var image_url pgtype.Text
	err := row.Scan(&image_url)
	return image_url, err
}

const getRecipeSteps = `-- name: GetRecipeSteps :many
SELECT
  id, recipe_id, step_number, instruction, image_url, created_at, updated_at
FROM
  recipe_steps
WHERE
  recipe_id = $1
ORDER BY
  step_number ASC
`

func (q *Queries) GetRecipeSteps(ctx context.Context, recipeID int64) ([]RecipeStep, error) {
	rows, err := q.db.Query(ctx, getRecipeSteps, recipeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []RecipeStep
	for rows.Next() {
		var i RecipeStep
		if err := rows.Scan(
			&i.ID,
			&i.RecipeID,
			&i.StepNumber,
			&i.Instruction,
			&i.ImageUrl,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getRecipesByOwner = `-- name: GetRecipesByOwner :many
SELECT
  r.user_id,
  r.image_url,
  r.title,
  r.description,
  r.created_at,
  r.updated_at,
  r.published,
  r.cook_time_minutes,
  u.first_name,
  u.last_name,
  u.id
FROM
  recipes r
  JOIN users u ON r.user_id = u.id
WHERE
  u.id = $1
ORDER BY
  r.updated_at DESC
`

type GetRecipesByOwnerRow struct {
	UserID          pgtype.Int8
	ImageUrl        pgtype.Text
	Title           string
	Description     pgtype.Text
	CreatedAt       pgtype.Timestamptz
	UpdatedAt       pgtype.Timestamptz
	Published       bool
	CookTimeMinutes pgtype.Int4
	FirstName       string
	LastName        string
	ID              int64
}

func (q *Queries) GetRecipesByOwner(ctx context.Context, id int64) ([]GetRecipesByOwnerRow, error) {
	rows, err := q.db.Query(ctx, getRecipesByOwner, id)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetRecipesByOwnerRow
	for rows.Next() {
		var i GetRecipesByOwnerRow
		if err := rows.Scan(
			&i.UserID,
			&i.ImageUrl,
			&i.Title,
			&i.Description,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.Published,
			&i.CookTimeMinutes,
			&i.FirstName,
			&i.LastName,
			&i.ID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUser = `-- name: GetUser :one
SELECT
  id,
  password_hash,
  ROLE
FROM
  users
WHERE
  email = trim(lower($1))
`

type GetUserRow struct {
	ID           int64
	PasswordHash string
	Role         Role
}

func (q *Queries) GetUser(ctx context.Context, lower string) (GetUserRow, error) {
	row := q.db.QueryRow(ctx, getUser, lower)
	var i GetUserRow
	err := row.Scan(&i.ID, &i.PasswordHash, &i.Role)
	return i, err
}

const getUserRefreshTokenHash = `-- name: GetUserRefreshTokenHash :one
SELECT
  refresh_token_hash,
  refresh_token_expires_at
FROM
  users
WHERE
  id = $1
`

type GetUserRefreshTokenHashRow struct {
	RefreshTokenHash      pgtype.Text
	RefreshTokenExpiresAt pgtype.Timestamptz
}

func (q *Queries) GetUserRefreshTokenHash(ctx context.Context, id int64) (GetUserRefreshTokenHashRow, error) {
	row := q.db.QueryRow(ctx, getUserRefreshTokenHash, id)
	var i GetUserRefreshTokenHashRow
	err := row.Scan(&i.RefreshTokenHash, &i.RefreshTokenExpiresAt)
	return i, err
}

const getUserRole = `-- name: GetUserRole :one
SELECT
  ROLE
FROM
  users
WHERE
  id = $1
`

func (q *Queries) GetUserRole(ctx context.Context, id int64) (Role, error) {
	row := q.db.QueryRow(ctx, getUserRole, id)
	var role Role
	err := row.Scan(&role)
	return role, err
}

const updateRecipe = `-- name: UpdateRecipe :exec
UPDATE
  recipes
SET
  image_url = coalesce($2, image_url),
  title = coalesce($3, title),
  description = coalesce($4, description),
  published = coalesce($5, published),
  cook_time_minutes = coalesce($6, cook_time_minutes)
WHERE
  id = $1
`

type UpdateRecipeParams struct {
	ID              int64
	ImageUrl        pgtype.Text
	Title           pgtype.Text
	Description     pgtype.Text
	Published       pgtype.Bool
	CookTimeMinutes pgtype.Int4
}

func (q *Queries) UpdateRecipe(ctx context.Context, arg UpdateRecipeParams) error {
	_, err := q.db.Exec(ctx, updateRecipe,
		arg.ID,
		arg.ImageUrl,
		arg.Title,
		arg.Description,
		arg.Published,
		arg.CookTimeMinutes,
	)
	return err
}

const updateRecipeCoverImage = `-- name: UpdateRecipeCoverImage :exec
UPDATE
  recipes
SET
  image_url = $1
WHERE
  id = $2
`

type UpdateRecipeCoverImageParams struct {
	ImageUrl pgtype.Text
	ID       int64
}

func (q *Queries) UpdateRecipeCoverImage(ctx context.Context, arg UpdateRecipeCoverImageParams) error {
	_, err := q.db.Exec(ctx, updateRecipeCoverImage, arg.ImageUrl, arg.ID)
	return err
}

const updateRecipeIngredient = `-- name: UpdateRecipeIngredient :exec
UPDATE
  recipe_ingredients
SET
  quantity = coalesce($2, quantity),
  unit = coalesce($3, unit),
  name = coalesce($4, name),
  image_url = coalesce($5, image_url)
WHERE
  id = $1
`

type UpdateRecipeIngredientParams struct {
	ID       int64
	Quantity pgtype.Float4
	Unit     pgtype.Text
	Name     pgtype.Text
	ImageUrl pgtype.Text
}

func (q *Queries) UpdateRecipeIngredient(ctx context.Context, arg UpdateRecipeIngredientParams) error {
	_, err := q.db.Exec(ctx, updateRecipeIngredient,
		arg.ID,
		arg.Quantity,
		arg.Unit,
		arg.Name,
		arg.ImageUrl,
	)
	return err
}

const updateRecipeIngredientImage = `-- name: UpdateRecipeIngredientImage :exec
UPDATE
  recipe_ingredients
SET
  image_url = $1
WHERE
  id = $2
`

type UpdateRecipeIngredientImageParams struct {
	ImageUrl pgtype.Text
	ID       int64
}

func (q *Queries) UpdateRecipeIngredientImage(ctx context.Context, arg UpdateRecipeIngredientImageParams) error {
	_, err := q.db.Exec(ctx, updateRecipeIngredientImage, arg.ImageUrl, arg.ID)
	return err
}

const updateRecipeStep = `-- name: UpdateRecipeStep :exec
UPDATE
  recipe_steps
SET
  instruction = coalesce($2, instruction),
  image_url = coalesce($3, image_url)
WHERE
  id = $1
`

type UpdateRecipeStepParams struct {
	ID          int64
	Instruction pgtype.Text
	ImageUrl    pgtype.Text
}

func (q *Queries) UpdateRecipeStep(ctx context.Context, arg UpdateRecipeStepParams) error {
	_, err := q.db.Exec(ctx, updateRecipeStep, arg.ID, arg.Instruction, arg.ImageUrl)
	return err
}

const updateRecipeStepImage = `-- name: UpdateRecipeStepImage :exec
UPDATE
  recipe_steps
SET
  image_url = $1
WHERE
  id = $2
`

type UpdateRecipeStepImageParams struct {
	ImageUrl pgtype.Text
	ID       int64
}

func (q *Queries) UpdateRecipeStepImage(ctx context.Context, arg UpdateRecipeStepImageParams) error {
	_, err := q.db.Exec(ctx, updateRecipeStepImage, arg.ImageUrl, arg.ID)
	return err
}

const updateUserRefreshTokenHash = `-- name: UpdateUserRefreshTokenHash :exec
UPDATE
  users
SET
  refresh_token_hash = $1
WHERE
  id = $2
`

type UpdateUserRefreshTokenHashParams struct {
	RefreshTokenHash pgtype.Text
	ID               int64
}

func (q *Queries) UpdateUserRefreshTokenHash(ctx context.Context, arg UpdateUserRefreshTokenHashParams) error {
	_, err := q.db.Exec(ctx, updateUserRefreshTokenHash, arg.RefreshTokenHash, arg.ID)
	return err
}
